{"version":3,"sources":["../../../src/utils/setup-helper.js"],"names":["log","require","getLogger","setDefaultIcon","L","Icon","Default","prototype","_getIconUrl","mergeOptions","iconRetinaUrl","iconUrl","shadowUrl","setPlugins","options","_map","addHandler","plugins","gisEvent","createGisClickHandler","call","createGisZoomendHandler","gisMode","createCircleHandler","createRectangleHandler","createMeasureHandler","measureOptions","createDrawHandler","drawOptions","gisclick","enable","giszoomend","setTruncate","layer","_truncateLabels","maxLength","shownOnHover","icon","_icon","dom","sh","getDeepestDom","children","content","innerHTML","truncated","_","truncate","length","omission","onmouseover","onmouseout","fireSelectionChange","e","DomEvent","stop","shouldStop","_dragMode","DRAG_MODE","DRAW","MEASURE","symbol","_symbols","_gis_id","_clusterSymbols","_flags","prevSelected","_selected","forEach","val","id","sbl","setSelected","type","EXTRA_SYMBOL_TYPE","CLUSTER","reduce","props","data","ids","acc","isEqual","fire","initialize","containerId","layers","isPlainObject","baseMap","providerName","url","baseMapUrl","tileLayer","pick","isArray","clusterOptions","option","has","symbolOptions","symbolOption","index","get","set","sumBy","_overlays","_groups","_visible","_layout","LAYOUT","STANDARD","dragMode","PAN","_regionType","regionType","REGION_TYPE","RECTANGLE","_drawType","drawType","DRAW_TYPE","MARKER","_symbolOptions","filter","match","group","isNil","warn","ERROR","INVALID_ARGS","dh","isValidArgType","string","_trackOptions","_heatmapOptions","DEFAULT_HEATMAP_STYLE","heatmapOptions","_contourOptions","DEFAULT_CONTOUR_STYLE","contourOptions","truncateLabels","_clusterOptions","el","map","chunkedLoading","showCoverageOnHover","zoomToBoundsOnClick","value","_eventMap","_clusters","_interval","center","zoom","minZoom","maxBounds","latLngBounds","latLng","maxBoundsViscosity","attributionControl","mapOptions","baseImage","images","valid","rh","renderOverlay","createPane","TRACK_PANE","_eventCore","featureGroup","on","bind","addTo","_flagGroup","SYMBOL_TYPE","SPOT","isValidLyr","FeatureGroup","hasLayer","drawHandler","drawMode","drawnGroup","_drawnGroup","enabled","_virtual_id","_editableIds","removeLayer","virtual","getLayer","addLayer","_virtual","renderSelectedCluster","panes","renderPane","setSymbol","layout","setLayout","REGION","toUpper","measureMode"],"mappings":"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","sourcesContent":["/**\r\n * Sets up the map before or during the creation\r\n *\r\n * @file   Functions involved during map creation.\r\n * @author Liszt\r\n */\r\n\r\nimport _ from 'lodash';\r\nimport L from 'leaflet';\r\nimport 'leaflet-draw';\r\nimport { tiledMapLayer } from 'esri-leaflet';\r\n\r\nimport iconRetinaUrl from 'leaflet/dist/images/marker-icon-2x.png';\r\nimport iconUrl from 'leaflet/dist/images/marker-icon.png';\r\nimport shadowUrl from 'leaflet/dist/images/marker-shadow.png';\r\n\r\nimport sh from './symbol-helper';\r\nimport rh from './render-helper';\r\nimport dh from './data-helper';\r\nimport { GIS_ERROR as ERROR } from './gis-exception';\r\nimport {\r\n  LAYOUT,\r\n  DRAG_MODE,\r\n  REGION_TYPE,\r\n  DRAW_TYPE,\r\n  SYMBOL_TYPE,\r\n  EXTRA_SYMBOL_TYPE,\r\n  TRACK_PANE\r\n} from '../consts/dictionary';\r\nimport { DEFAULT_HEATMAP_STYLE, DEFAULT_CONTOUR_STYLE } from '../consts/style';\r\nimport plugins from '../plugins';\r\n\r\nconst log = require('loglevel').getLogger('gis/utils/setup');\r\n\r\n\r\n/**\r\n * Fixes the marker image issue.\r\n *\r\n * @return this\r\n */\r\nfunction setDefaultIcon() {\r\n  delete L.Icon.Default.prototype._getIconUrl;\r\n\r\n  L.Icon.Default.mergeOptions({\r\n    iconRetinaUrl,\r\n    iconUrl,\r\n    shadowUrl\r\n  });\r\n\r\n  return this;\r\n}\r\n\r\n/**\r\n * Sets up all the customized leaflet handlers.\r\n *\r\n * @link - https://git.gorilla-technology.com/gorilla/gis/blob/master/docs/gis.md#measure-options\r\n * @link - https://git.gorilla-technology.com/gorilla/gis/blob/master/docs/gis.md#draw-options\r\n *\r\n * @param {Object} [options={measureOptions:{}, drawOptions:{}}]    Options for measure and draw modes\r\n * @param {Object} [options.measureOptions={}]                      Options for measure mode. See the link above\r\n * @param {Object} [options.drawOptions={}]                         Options for draw mode. See the link above.\r\n *\r\n * @return this\r\n */\r\nfunction setPlugins(options) {\r\n  this._map.addHandler('gisclick', plugins.gisEvent.createGisClickHandler.call(this, L));\r\n  this._map.addHandler('giszoomend', plugins.gisEvent.createGisZoomendHandler.call(this, L));\r\n  this._map.addHandler('circleSelector', plugins.gisMode.createCircleHandler.call(this, L));\r\n  this._map.addHandler('rectangleSelector', plugins.gisMode.createRectangleHandler.call(this, L));\r\n  this._map.addHandler('measureMode', plugins.gisMode.createMeasureHandler.call(this, L, options.measureOptions));\r\n  this._map.addHandler('drawMode', plugins.gisMode.createDrawHandler.call(this, L, options.drawOptions));\r\n\r\n  this._map.gisclick.enable();\r\n  this._map.giszoomend.enable();\r\n\r\n  return this;\r\n}\r\n\r\n/**\r\n * Set the truncateLabel if specified\r\n *\r\n * @param {L.Marker} layer  The leaflet Marker instance. In GIS, layer instances of Marker & Spot are L.Marker.\r\n *\r\n * @return this\r\n */\r\nfunction setTruncate(layer) {\r\n  if (this._truncateLabels) {\r\n    const { maxLength, shownOnHover } = this._truncateLabels;\r\n    const icon = layer._icon;\r\n    const dom = sh.getDeepestDom(icon.children[1]);\r\n    const content = dom.innerHTML;\r\n    const truncated = _.truncate(content, {\r\n      length: maxLength,\r\n      omission: '...'\r\n    });\r\n\r\n    dom.innerHTML = truncated;\r\n\r\n    // Show whole content when mouseover is trigger if truncateLabels.shownOnHover is *true*\r\n    if (shownOnHover) {\r\n      icon.onmouseover = () => { dom.innerHTML = content; };\r\n      icon.onmouseout = () => { dom.innerHTML = truncated; };\r\n    }\r\n  }\r\n\r\n  return this;\r\n}\r\n\r\n/**\r\n * The event callback for selectionChange.\r\n * This is the implementation of clicking on map to trigger selectionChange\r\n *\r\n * @param {EventObject} e   The event object of the GIS selectionChange\r\n *\r\n */\r\nexport function fireSelectionChange(e) {\r\n  // preventDefault and stopPropagation\r\n  L.DomEvent.stop(e);\r\n\r\n  // Prevent unexpected behavior in these two modes\r\n  const shouldStop = this._dragMode === DRAG_MODE.DRAW\r\n            || this._dragMode === DRAG_MODE.MEASURE;\r\n\r\n  if (shouldStop) {\r\n    return;\r\n  }\r\n\r\n  const { layer } = e;\r\n  const symbol = this._symbols[layer._gis_id]\r\n          || this._clusterSymbols[layer._gis_id]\r\n          || this._flags[layer._gis_id];\r\n\r\n  const prevSelected = { ...this._selected };\r\n\r\n  _.forEach(this._selected, (val, id) => {\r\n    const sbl = this._symbols[id] || this._flags[id];\r\n    sbl.setSelected(false);\r\n  });\r\n\r\n  if (symbol && symbol.type === EXTRA_SYMBOL_TYPE.CLUSTER) {\r\n    this._selected = _.reduce(symbol.props.data.ids, (acc, id) => {\r\n      this._symbols[id].setSelected(true);\r\n      acc[id] = true;\r\n      return acc;\r\n    }, {});\r\n  } else if (symbol) {\r\n    symbol.setSelected(true);\r\n    this._selected = { [symbol.id]: true };\r\n  }\r\n\r\n  if (!_.isEqual(prevSelected, this._selected)) {\r\n    this._map.fire('selectionChange', { layer })\r\n      .fire('clusterselectionChange');\r\n  }\r\n}\r\n\r\n/**\r\n * Creates the GIS map.\r\n *\r\n * @link    https://git.gorilla-technology.com/gorilla/gis/blob/master/docs/gis.md#options\r\n *\r\n * @param {String | HTMLElement} containerId    The target DOM id or node to create the map.\r\n * @param {Object}               options        GIS options. See the link above\r\n * @param {Object[]}             [data]         Symbol raw data to create on the map\r\n *\r\n */\r\nexport function initialize(containerId, options, data) {\r\n  /* Remove default baseMap coz, areaMap(mercator projection) do not need baseMap\r\n  // If map url is not specified, use OSM map\r\n  if (typeof options.baseMap === 'undefined') {\r\n    options.baseMap = {\r\n      url: 'http://{s}.tile.osm.org/{z}/{x}/{y}.png',\r\n      subdomains: ['a', 'b', 'c'],\r\n      // attribution: '&copy; <a href=\"http://openstreetmap.org/copyright\">OpenStreetMap</a> contributors'\r\n    }\r\n  }\r\n  */\r\n\r\n  let layers;\r\n  // Added support for esri/ArcGIS map\r\n  if (_.isPlainObject(options.baseMap) && typeof options.baseMap.providerName !== 'undefined' && options.baseMap.providerName === 'esri') {\r\n    layers = [tiledMapLayer({\r\n      url: options.baseMap.url\r\n    })];\r\n  } else {\r\n    const baseMapUrl = _.isPlainObject(options.baseMap) ? options.baseMap.url : options.baseMap;\r\n    const baseMap = _.isPlainObject(options.baseMap)\r\n      ? L.tileLayer(baseMapUrl, _.pick(options.baseMap, 'subdomains'))\r\n      : baseMapUrl ? L.tileLayer(baseMapUrl) : null;\r\n    layers = _.isArray(options.baseMap) ? options.baseMap : [baseMap];\r\n  }\r\n\r\n  //Added support for summing by custom key\r\n  _.forEach(options.clusterOptions, option=>{\r\n    if(!_.has(option,\"props.symbol.sumBy\") || !_.has(option,\"id\"))\r\n      return\r\n    const id = option.id\r\n    _.forEach(options.symbolOptions, (symbolOption, index)=>{\r\n      if(id===_.get(symbolOption,\"props.cluster\")){\r\n        _.set(options.symbolOptions, [index, \"props\", \"__toSum\"], (data)=>_.get(data, option.props.symbol.sumBy))//save toSum in marker\r\n        return false;\r\n      }\r\n    })\r\n  })\r\n\r\n  setDefaultIcon.call(this);\r\n\r\n  // Private properties\r\n  this._overlays = {};\r\n  this._symbols = {};\r\n  this._groups = {};\r\n  this._selected = {};\r\n  this._visible = {};\r\n  this._layout = LAYOUT.STANDARD;\r\n  this._dragMode = options.dragMode || DRAG_MODE.PAN;\r\n  this._regionType = options.regionType || REGION_TYPE.RECTANGLE;\r\n  this._drawType = options.drawType || DRAW_TYPE.MARKER;\r\n\r\n  // Enhancement for issue #31\r\n  // Filter this._symbolOptions, remove the ones which doesn't match format\r\n  this._symbolOptions = _.filter(_.get(options, 'symbolOptions', null), ({ match }) => {\r\n    if ((_.isPlainObject(match) && !match.id && !match.type && !match.data && !match.group) && !_.isNil(match)) {\r\n      log.warn(\r\n        ERROR.INVALID_ARGS,\r\n        match,\r\n        'Filter should be an Object and contain at least one of the following pair. '\r\n        + 'id: String/String[]; type: String/String[]; data: Object'\r\n      );\r\n      return false;\r\n    }\r\n\r\n    if (_.get(match, 'id') && !dh.isValidArgType(match.id, ['string', ['string']])) {\r\n      log.warn(ERROR.INVALID_ARGS, match.id, 'Type of value in \\'id\\' should be String/String[]');\r\n      return false;\r\n    }\r\n\r\n    if (_.get(match, 'type') && !dh.isValidArgType(match.type, ['string', ['string']])) {\r\n      log.warn(ERROR.INVALID_ARGS, match.type, 'Type of value in \\'type\\' should be String/String[]');\r\n      return false;\r\n    }\r\n\r\n    if (_.get(match, 'data') && !dh.isValidArgType(match.data, 'plainObject')) {\r\n      log.warn(ERROR.INVALID_ARGS, match.data, 'Type of value in \\'data\\' should be Object');\r\n      return false;\r\n    }\r\n\r\n    if (_.get(match, 'group') && !dh.isValidArgType(match.group, 'string')) {\r\n      log.warn(ERROR.INVALID_ARGS, match.string, 'Type of value in \\'group\\' should be String');\r\n      return false;\r\n    }\r\n\r\n    return !match || !!_.get(match, 'id') || !!_.get(match, 'type') || !!_.get(match, 'data') || !!_.get(match, 'group');\r\n  });\r\n\r\n  this._trackOptions = _.get(options, 'trackOptions', null);\r\n  this._heatmapOptions = { ...DEFAULT_HEATMAP_STYLE, ...options.heatmapOptions };\r\n  this._contourOptions = { ...DEFAULT_CONTOUR_STYLE, ...options.contourOptions };\r\n  this._truncateLabels = options.truncateLabels\r\n    ? {\r\n      maxLength: _.get(options, 'truncateLabels.maxLength', 13),\r\n      shownOnHover: _.get(options, 'truncateLabels.shownOnHover', true)\r\n    }\r\n    : null;\r\n\r\n  this._clusterOptions = _(options.clusterOptions)\r\n    .filter((el) => {\r\n      if (el.id === false) {\r\n        log.warn(ERROR.INVALID_ARGS, el.id, 'Cluster Id should be \\'true\\' or a String.');\r\n        return false;\r\n      }\r\n\r\n      if (!el.props) {\r\n        log.warn(ERROR.INVALID_ARGS, el.props, 'props in clusterOptions[] is required');\r\n        return false;\r\n      }\r\n\r\n      return (_.isNil(el.id) || el.id) && !!el.props;\r\n    })\r\n    .map(el => ({\r\n      ...el,\r\n      props: {\r\n        chunkedLoading: true,\r\n        showCoverageOnHover: false,\r\n        zoomToBoundsOnClick: false,\r\n        ..._.get(el, 'props', {})\r\n      }\r\n    }))\r\n    .value();\r\n\r\n  this._eventMap = []; // Fix issue #22\r\n  this._clusters = {};\r\n  this._clusterSymbols = {}; // Store the parent nodes\r\n\r\n  // Enhancement for track with timebar\r\n  this._interval = [];\r\n\r\n  // They need to properly split them and input them\r\n  // Create map\r\n  this._map = L.map(containerId, {\r\n    // preferCanvas: true,\r\n    layers: _.filter(layers, el => (!!el)),\r\n    center: [0, 0],\r\n    zoom: 8,\r\n    // Restrict panning within map\r\n    minZoom: 2,\r\n    maxBounds: L.latLngBounds(L.latLng(90, -180), L.latLng(-90, 180)),\r\n    maxBoundsViscosity: 1.0,\r\n    attributionControl: false,\r\n    ...options.mapOptions\r\n  });\r\n\r\n  // Enable region-selection and set icon url\r\n  setPlugins.call(this, {\r\n    measureOptions: options.measureOptions || {},\r\n    drawOptions: options.drawOptions || {}\r\n  });\r\n\r\n  if (options.baseImage) {\r\n    const images = _.filter(options.baseImage, (el) => {\r\n      const valid = dh.isValidArgType(el, ['string', 'plainObject', ['plainObject']]);\r\n      if (!valid) {\r\n        log.warn(ERROR.INVALID_ARGS, el, 'Please enter a valid baseImage type, which is String, Object, or Object[]');\r\n        log.warn(\r\n          ERROR.INVALID_ARGS,\r\n          el,\r\n          'If it\\'s an Object, it should be {id:String, url:String, xy:{x:Number, y:Number}, size:{width:String, height:String}, opacity:Number, zoom:Number'\r\n        );\r\n      }\r\n\r\n      return valid;\r\n    });\r\n\r\n    // const resetBounds = _.isNil(_.get(options, 'mapOptions.maxBounds'))\r\n    // const resetZoom = _.isNil(_.get(options, 'mapOptions.zoom'))\r\n    // rh.renderOverlay.call(this, images, resetBounds, resetZoom)\r\n    rh.renderOverlay.call(this, images);\r\n  }\r\n\r\n  // Create the pane to place the tracks' signs which makes them on the top layer\r\n  this._map.createPane(TRACK_PANE);\r\n\r\n  // For managing events\r\n  this._eventCore = L.featureGroup([])\r\n  // Enable trigger selectionChange by clicking\r\n    .on('click', fireSelectionChange.bind(this))\r\n    .addTo(this._map);\r\n\r\n  // Used for track mode\r\n  this._flagGroup = L.featureGroup([]).addTo(this._map);\r\n\r\n  // For setting the label truncate\r\n  this._map.on('layeradd', ({ layer }) => {\r\n    const id = layer._gis_id;\r\n    const type = _.get(this._symbols, `${id}.type`);\r\n\r\n    if (type === SYMBOL_TYPE.MARKER || type === SYMBOL_TYPE.SPOT) {\r\n      setTruncate.call(this, layer);\r\n    }\r\n  });\r\n\r\n  // Add new symbol layer to _eventCore to manage the events\r\n  // virtualadd and virtualremove are for draw mode\r\n  this._map.on('layeradd virtualadd', ({ layer }) => {\r\n    const id = layer._gis_id;\r\n    const symbol = _.get(this._symbols, id)\r\n            || _.get(this._clusterSymbols, id)\r\n            || _.get(this._flags, id);\r\n\r\n    // Duplicated added or featureGroup may trigger event twice. Need to skip them\r\n    const isValidLyr = symbol\r\n              && !(layer instanceof L.FeatureGroup)\r\n              && !this._eventCore.hasLayer(layer);\r\n\r\n    const drawHandler = this._map.drawMode;\r\n    const drawnGroup = drawHandler._drawnGroup;\r\n    // In draw mode\r\n    if (drawHandler.enabled() && layer._virtual_id && this._editableIds[id]) {\r\n      this._map.removeLayer(layer);\r\n      const virtual = drawnGroup.getLayer(layer._virtual_id);\r\n      !virtual && drawnGroup.addLayer(drawHandler._virtual[id]);\r\n    } else if (!drawHandler.enabled() && isValidLyr) {\r\n      !this._eventCore.hasLayer(layer) && this._eventCore.addLayer(layer);\r\n    }\r\n  });\r\n\r\n  // Remove symbol layer from _eventCore & drawnGroup\r\n  // virtualadd and virtualremove are for draw mode\r\n  this._map.on('layerremove virtualremove', ({ layer }) => {\r\n    this._eventCore.hasLayer(layer) && this._eventCore.removeLayer(layer);\r\n\r\n    // In draw mode, need to clear the virtual symbols if original is removed\r\n    const drawHandler = this._map.drawMode;\r\n    const drawnGroup = drawHandler._drawnGroup;\r\n\r\n    if (layer._virtual_id && drawHandler.enabled() && drawnGroup) {\r\n      const virtual = drawnGroup.getLayer(layer._virtual_id);\r\n      virtual && drawnGroup.removeLayer(virtual);\r\n    }\r\n  });\r\n\r\n  /*\r\n    Re-render the cluster for the selected cluster.\r\n    When changeing zoom level or running show/hide/filter-symbols,\r\n    cluster parent layer will be added or removed.\r\n  */\r\n  this._map.on('clusterselectionChange', () => {\r\n    rh.renderSelectedCluster.call(this);\r\n  });\r\n\r\n  // Set panes\r\n  options.panes && rh.renderPane.call(this, options.panes);\r\n\r\n  // Set symbols\r\n  data && this.setSymbol(data);\r\n\r\n  // Set the layout\r\n  options.layout && this.setLayout(options.layout);\r\n\r\n  // Set the drag mode if region-selection is enabled\r\n  if (this._dragMode === DRAG_MODE.REGION && REGION_TYPE[_.toUpper(this._regionType)]) {\r\n    this._map[`${this._regionType}Selector`].enable();\r\n  } else if (this._dragMode === DRAG_MODE.MEASURE) {\r\n    this._map.measureMode.enable();\r\n  } else if (this._dragMode === DRAG_MODE.DRAW) {\r\n    this._map.drawMode.enable();\r\n  }\r\n}\r\n"],"file":"setup-helper.js"}