{"version":3,"sources":["../../../src/utils/normalize-helper.js"],"names":["SPECIAL","RENDERABLES","normalizeRenderable","symbolData","srcProps","srcSelectedProps","tgtProps","_","cloneDeep","tgtSelected","setRenderable","src","key","id","type","props","selected","selectedProps","result","isFunction","shouldNormalize","isString","isPlainObject","includes","isBoolean","set","forEach","prop","normalizeClassname","srcClasses","classNames","replace","split","isArray","length","reduce","acc","el","push","chain","uniq","join","value","normalizeIcon","icons","isEmpty","iconUrl","normalizeInfo","infos","typeOfInfo","content","className","isElement","html","normalizeTrack","tracks","normalizeProps","sources","mergeWith","objVal","srcVal","srcStr","concat","tooltip","popup","icon","label","omitBy","isNil"],"mappings":"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","sourcesContent":["import _ from 'lodash'\r\n\r\nconst SPECIAL = ['className', 'tooltip', 'popup', 'label', 'icon']\r\nconst RENDERABLES = [\r\n    'tooltip',\r\n    'popup',\r\n    'label',\r\n    'icon',\r\n    'track',\r\n    'cluster',\r\n    'group',\r\n    'type'\r\n]\r\n\r\n// For tooltip/popup/label/icon/track/cluster/group which is a function\r\nexport function normalizeRenderable(symbolData, srcProps={}, srcSelectedProps={}) {\r\n    const tgtProps = _.cloneDeep(srcProps)\r\n    const tgtSelected = _.cloneDeep(srcSelectedProps)\r\n\r\n    const setRenderable = (src, key, {id, type, props, selected, selectedProps}) => {\r\n        // 'type' may be from 'props' because it may be defined in symbolOptions, not symbol data itself\r\n        const result = _.isFunction(src[key]) ?\r\n                        src[key]({id, type:type || props.type, ...props, selected, selectedProps}) :\r\n                        null\r\n\r\n        // Only normalize the prop when src[key] returns a String, or a Boolean for cluster/group\r\n        const shouldNormalize = _.isString(result) ||\r\n                                (_.isPlainObject(result) && !_.includes(['track', 'cluster', 'group', 'type'], key)) ||\r\n                                ((key === 'cluster' || key === 'group') && _.isBoolean(result))\r\n\r\n        if (shouldNormalize) {\r\n            _.set(src, key, result)\r\n        }\r\n    }\r\n\r\n    _.forEach(RENDERABLES, prop => {\r\n        setRenderable(tgtProps, prop, symbolData)\r\n        setRenderable(tgtSelected, prop, symbolData)\r\n    })\r\n\r\n    return {\r\n        props: tgtProps,\r\n        selectedProps: tgtSelected\r\n    }\r\n}\r\n\r\n/* Argument is an array of symbol props.className */\r\nexport function normalizeClassname(srcClasses) {\r\n    let classNames = []\r\n\r\n    if (_.isString(srcClasses)) {\r\n        classNames = srcClasses.replace(/\\s{2,}/g, ' ').split(' ')\r\n    }\r\n    else if ((_.isArray(srcClasses) && srcClasses.length === 0) || !srcClasses) {\r\n        return null\r\n    }\r\n    else if (_.isArray(srcClasses) && srcClasses.length > 0) {\r\n        classNames = _.reduce(srcClasses, (acc, el) => {\r\n            el && acc.push(el.replace(/\\s{2,}/g, ' '))\r\n            return acc\r\n        }, [])\r\n    }\r\n\r\n    return _.chain(classNames)\r\n        .uniq()\r\n        .join(' ')\r\n        .value()\r\n}\r\n\r\n/* Argument is a symbol object */\r\nexport function normalizeIcon(icons) {\r\n    if (_.isEmpty(icons) || !icons) {\r\n        return {}\r\n    }\r\n    const result = _.reduce(icons, (acc, el) => {\r\n        if (_.isString(el) && !acc.iconUrl) {\r\n            acc.iconUrl = el\r\n            return acc\r\n        }\r\n\r\n        if (_.isString(el)) {\r\n            acc.iconUrl = el\r\n        }\r\n        else if (_.isPlainObject(el)) {\r\n            acc = {...acc, ...el}\r\n        }\r\n\r\n        return acc\r\n    }, {})\r\n\r\n    return result\r\n}\r\n\r\n/* Argument is a symbol object and type of info, including 'tooltip', 'popup' and 'label' */\r\nexport function normalizeInfo(infos, typeOfInfo) {\r\n    if (_.isEmpty(infos) || !infos) {\r\n        return typeOfInfo === 'label' ? {content:'', className:''} : null\r\n    }\r\n\r\n    const result = _.reduce(infos, (acc, el) => {\r\n        if ((_.isString(el) || _.isElement(el)) && !acc.content) {\r\n            acc.content = el\r\n            return acc\r\n        }\r\n\r\n        if (_.isString(el) || _.isElement(el)) {\r\n            acc.content = el\r\n        }\r\n        else if (_.isPlainObject(el)) {\r\n            acc = {...acc, ...el}\r\n\r\n            // 'label' may have 'html' key\r\n            acc.content = acc.html || acc.content || ''\r\n            delete acc.html\r\n        }\r\n\r\n        return acc\r\n    }, {})\r\n\r\n    return (result.content && !_.isEmpty(result.content)) ? result : null\r\n}\r\n\r\nexport function normalizeTrack(tracks) {\r\n\r\n}\r\n\r\n/* Arguments are symbol id, type, and an array of symbol props/selectedProps */\r\nexport default function normalizeProps(sources) {\r\n    if (_.isArray(sources) && sources.length === 0) {\r\n        return {}\r\n    }\r\n\r\n    const result = _.mergeWith({}, ...sources, (objVal, srcVal, key) => {\r\n        if (key === 'className' && srcVal) {\r\n            const srcStr = srcVal.replace(/\\s{2,}/g, ' ').split(' ')\r\n            objVal = objVal || []\r\n            objVal = _.concat(objVal, srcStr)\r\n\r\n            return objVal\r\n        }\r\n        else if (_.includes(SPECIAL, key)) {\r\n            objVal = objVal || []\r\n            objVal.push(srcVal)\r\n\r\n            return objVal\r\n        }\r\n    })\r\n\r\n    _.set(result, 'className', normalizeClassname(result.className))\r\n    _.set(result, 'tooltip', normalizeInfo(result.tooltip, 'tooltip'))\r\n    _.set(result, 'popup', normalizeInfo(result.popup, 'popup'))\r\n\r\n    // For markers and spots\r\n    if (result.icon || result.label) {\r\n        _.set(result, 'icon', normalizeIcon(result.icon))\r\n        _.set(result, 'label', normalizeInfo(result.label, 'label'))\r\n    }\r\n\r\n    return _.omitBy(result, _.isNil)\r\n}"],"file":"normalize-helper.js"}