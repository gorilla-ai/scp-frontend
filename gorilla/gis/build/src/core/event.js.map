{"version":3,"sources":["../../../src/core/event.js"],"names":["log","require","getLogger","_on","event","filter","handler","args","arguments","length","_","isFunction","isZoom","includes","isMeasure","isDrawn","isInvalidArgs","isNil","isPlainObject","EVENT","warn","ERROR","INVALID_TYPE","INVALID_ARGS","map","_map","eventHandler","e","zoom","getZoom","bounds","getBounds","southWest","y","_southWest","lat","x","lng","northEast","_northEast","_dragMode","DRAG_MODE","MEASURE","pathInfo","layers","DRAW","symbol","L","DomEvent","stop","shouldStop","isMultiple","targetId","get","_symbols","_clusterSymbols","_flags","undefined","type","matchedIds","sh","getSymbol","call","concat","keys","excludeIds","eventIds","EXTRA_SYMBOL_TYPE","CLUSTER","props","data","ids","id","triggerIds","difference","intersection","hasMatch","cluster","fire","selected","_eventMap","push","_eventCore","on","_off","isZoomOrDraw","evtIdx","findIndex","evt","record","isEqual","off","slice","exclude","uniq","reduce","acc","excld","forEach","remove","fireSelectionChange","bind"],"mappings":"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","sourcesContent":["/**\r\n * Event related functions.\r\n *\r\n * @file   This file is the collection of event-related functions.\r\n * @author Liszt\r\n */\r\n\r\nimport _ from 'lodash'\r\nimport L from 'leaflet'\r\n\r\nimport {DRAG_MODE, EVENT, EXTRA_SYMBOL_TYPE} from '../consts/dictionary'\r\nimport {GIS_ERROR as ERROR} from '../utils/gis-exception'\r\nimport {fireSelectionChange} from '../utils/setup-helper'\r\nimport sh from '../utils/symbol-helper'\r\n\r\nlet log = require('loglevel').getLogger('gis/core/event')\r\n\r\n/**\r\n * Binds a new event to eventCore.\r\n * eventCore is considered as an event management in GIS, which is a Leaflet FeatureGroup.\r\n * All events, in fact, are bound to the feature group, and are executed in it.\r\n *\r\n * @link    https://git.gorilla-technology.com/gorilla/gis/blob/master/docs/gis.md#events\r\n *\r\n * @param   {String}                                  event      Event type. E.g., click, dblclick, contextmenu, etc. See the GIS document for detail.\r\n * @param   {String | String[] | Object | function}   [filter]   Symbols filter. Matched symbols will apply the event. Apply to all symbols and map when undefined.\r\n * @param   {Function}                                handler    Event callback handler.\r\n *\r\n */\r\nexport function _on(event, filter, handler) {\r\n    // Order the arguments\r\n    const args = {\r\n        event,\r\n        filter: (arguments.length === 3) ? filter : null,\r\n        handler: handler || (_.isFunction(filter) ? filter : null)\r\n    }\r\n\r\n    // These 3 types of events only happens on the map\r\n    const isZoom = _.includes(['zoomstart', 'zoom', 'zoomend'], event)\r\n    const isMeasure = _.includes(['measurestart', 'measure', 'measureend'], event)\r\n    const isDrawn = _.includes(['create', 'edit', 'editcontent', 'delete'], event)\r\n\r\n    const isInvalidArgs = (!_.isNil(args.filter) && !_.isPlainObject(args.filter)) || !_.isFunction(args.handler)\r\n\r\n    // Check event type and arguments are valid or not\r\n    if (!_.includes(EVENT, event)) {\r\n        log.warn(ERROR.INVALID_TYPE, event, `Please input valid events: ${EVENT}`)\r\n        return\r\n    }\r\n    else if ((isZoom || isMeasure || isDrawn) && args.filter) {\r\n        log.warn(\r\n            ERROR.INVALID_ARGS,\r\n            [event, filter, handler],\r\n            'Zoom, measure, and draw related event is global, which means no filter is required.'\r\n        )\r\n\r\n        return\r\n    }\r\n    else if (isInvalidArgs) {\r\n        log.warn(\r\n            ERROR.INVALID_ARGS,\r\n            [event, filter, handler],\r\n            'The arguments should be (String event, Object filter?, Function handler)'\r\n        )\r\n\r\n        return\r\n    }\r\n\r\n    const map = this._map\r\n\r\n    // Consider eventHandler as an handler entry.\r\n    // Save it in a global Object variable for unbinding\r\n    let eventHandler = null\r\n\r\n    if (isZoom) {\r\n        eventHandler = e => {\r\n            const zoom = map.getZoom()        // Current zoom level\r\n            const bounds = map.getBounds()    // Current bounds\r\n\r\n            args.handler(e, {\r\n                zoom,\r\n                bounds: {\r\n                    southWest: {y:bounds._southWest.lat, x:bounds._southWest.lng},\r\n                    northEast: {y:bounds._northEast.lat, x:bounds._northEast.lng}\r\n                }\r\n            })\r\n        }\r\n    }\r\n    else if (isMeasure) {\r\n        eventHandler = e => {\r\n            if (this._dragMode === DRAG_MODE.MEASURE) {\r\n                args.handler(e.event, e.pathInfo, e.layers)\r\n            }\r\n        }\r\n    }\r\n    else if (isDrawn) {\r\n        eventHandler = e => {\r\n            if (this._dragMode === DRAG_MODE.DRAW) {\r\n                // Here, e.symbol is a plain object, not Symbol instance\r\n                args.handler(e.event, e.symbol)\r\n            }\r\n        }\r\n    }\r\n    else {\r\n        eventHandler = e => {\r\n            L.DomEvent.stop(e)\r\n\r\n            // Prevent unexpected behavior in measure & draw mode.\r\n            const shouldStop = this._dragMode === DRAG_MODE.MEASURE ||\r\n                            this._dragMode === DRAG_MODE.DRAW\r\n\r\n            if (shouldStop) {\r\n                return\r\n            }\r\n\r\n            const isMultiple = e.isMultiple === true // triggered by region selection or setSelection()\r\n\r\n            const targetId = _.get(e, 'layer._gis_id')\r\n            const symbol = targetId ?\r\n                            this._symbols[targetId] || this._clusterSymbols[targetId] || this._flags[targetId] :\r\n                            undefined\r\n\r\n            const type = _.get(symbol, 'type', undefined)\r\n\r\n            // Get symbols which match the filter\r\n            const matchedIds = args.filter ?\r\n                                sh.getSymbol.call({_symbols:{...this._symbols, ...this._flags}}, args.filter, true, 'id') :\r\n                                _.concat(_.keys(this._symbols), _.keys(this._flags))\r\n\r\n            // Enhancement for fixing the issue in off()\r\n            // For excluding the symbols matched in off() filter\r\n            const excludeIds = _.get(args, 'excludeIds', [])\r\n\r\n            // Symbols to be triggered in the event\r\n            const eventIds = type === EXTRA_SYMBOL_TYPE.CLUSTER\r\n                            ? symbol.props.data.ids\r\n                            : type ? [symbol.id] : []\r\n\r\n            // Pick up the symbolId which matches the filter then excluding the ones should be removed due to off()\r\n            const triggerIds = _.difference(_.intersection(matchedIds, eventIds), excludeIds)\r\n            const hasMatch = triggerIds.length > 0\r\n\r\n            // Event on cluster parent\r\n            if (type === EXTRA_SYMBOL_TYPE.CLUSTER && hasMatch) {\r\n                if (e.type === 'selectionChange') {\r\n                    args.handler(e, triggerIds)\r\n                }\r\n                else {\r\n                    args.handler(e, triggerIds, {cluster:_.get(symbol, 'props.data.cluster')})\r\n                }\r\n\r\n                map.fire('clusterselectionChange')\r\n            }\r\n            // Event on symbol\r\n            else if (type && type !== EXTRA_SYMBOL_TYPE.CLUSTER && hasMatch) {\r\n                args.handler(e, triggerIds[0])\r\n            }\r\n            // Event on map\r\n            else if (!type && !isMultiple) {\r\n                args.handler(e, null)\r\n            }\r\n            // Event by region selection or by setSelection()\r\n            else if (isMultiple) {\r\n                args.handler(e, this.selected.length === 0 ? null : this.selected)\r\n            }\r\n        }\r\n    }\r\n\r\n    /*\r\n        Handler is for matching the one from external, wrapped as eventHandler.\r\n        eventHandler is the one we should utilize to remove in off() method\r\n    */\r\n    args.eventHandler = eventHandler\r\n    this._eventMap.push(args)\r\n\r\n    if (!isZoom && !isMeasure && !isDrawn) {\r\n        this._eventCore.on(event, eventHandler)\r\n    }\r\n\r\n    if (!args.filter) {\r\n        map.on(event, eventHandler)\r\n    }\r\n}\r\n\r\n/**\r\n * Unbinds a event.\r\n * Here, it updates the filter saved in _on function,\r\n * and adds a excluedIds for skipping symbols shouldn't trigger event.\r\n *\r\n * @link    https://git.gorilla-technology.com/gorilla/gis/blob/master/docs/gis.md#events\r\n *\r\n * @param   {String}                                  event      Event type. E.g., click, dblclick, contextmenu, etc. See the GIS document for detail.\r\n * @param   {String | String[] | Object | function}   [filter]   Symbols filter. Matched symbols will not apply the target event. Apply to all symbols and map when undefined.\r\n * @param   {Function}                                [handler]  Event callback handler to be removed. Remove all the specific event handler when undefined.\r\n *\r\n */\r\nexport function _off(event, filter, handler) {\r\n    const args = {\r\n        event,\r\n        filter: (arguments.length === 3) ? filter : null,\r\n        handler: handler || (_.isFunction(filter) ? filter : null)\r\n    }\r\n\r\n    const isZoomOrDraw = _.includes(['zoomstart', 'zoom', 'zoomend', 'measurestart', 'measure', 'measureend'], event)\r\n    const isInvalidArgs = (!_.isNil(args.filter) && !_.isPlainObject(args.filter)) ||\r\n                        (!_.isNil(args.handler) && !_.isFunction(args.handler))\r\n\r\n    // Check event type and arguments are valid or not\r\n    if (!_.includes(EVENT, event)) {\r\n        log.warn(ERROR.INVALID_TYPE, event, `Please input valid events: ${EVENT}`)\r\n        return\r\n    }\r\n    else if (isZoomOrDraw && args.filter) {\r\n        log.warn(\r\n            ERROR.INVALID_ARGS,\r\n            [event, filter, handler],\r\n            'Zoom or measure related event is global, which means no filter is required.'\r\n        )\r\n\r\n        return\r\n    }\r\n    else if (isInvalidArgs) {\r\n        log.warn(\r\n            ERROR.INVALID_ARGS,\r\n            [event, filter, handler],\r\n            'The arguments should be (String event, Object filter?, Function handler?)'\r\n        )\r\n\r\n        return\r\n    }\r\n\r\n    const map = this._map\r\n    const evtIdx = _.findIndex(this._eventMap, evt => evt.handler === handler)\r\n    const record = evtIdx > -1 ? this._eventMap[evtIdx] : null\r\n\r\n    // If handler is specified, and no filter or the filter is the same as the record, remove the event\r\n    if (record && (!args.filter || _.isEqual(record.filter, args.filter))) {\r\n        map.off(args.event, this._eventMap[evtIdx].eventHandler)\r\n        this._eventCore.off(args.event, this._eventMap[evtIdx].eventHandler)\r\n        this._eventMap.slice(evtIdx, 1)\r\n    }\r\n    // If filter and (record or no handler), remove matched symbols' events, by adding the exclude filter\r\n    else if ((record || !args.handler) && args.filter) {\r\n        if (record) {\r\n            // For fixing new symbols can't apply event\r\n            if (!record.exclude) {\r\n                record.exclude = []\r\n            }\r\n\r\n            record.exclude.push(args.filter)\r\n            record.excludeIds = _.uniq(_.reduce(record.exclude, (acc, excld) => {\r\n                return _.concat(acc, sh.getSymbol.call(this, excld, true, 'id'))\r\n            }, []))\r\n        }\r\n        else {\r\n            _.forEach(this._eventMap, evt => {\r\n                if (evt.event === args.event) {\r\n                    // For fixing new symbols can't apply event\r\n                    if (!evt.exclude) {\r\n                        evt.exclude = []\r\n                    }\r\n\r\n                    evt.exclude.push(args.filter)\r\n                    evt.excludeIds = _.uniq(_.reduce(evt.exclude, (acc, excld) => {\r\n                        return _.concat(acc, sh.getSymbol.call(this, excld, true, 'id'))\r\n                    }, []))\r\n                }\r\n            })\r\n        }\r\n    }\r\n    // If no filter and no handler, remove all handlers of the event\r\n    else if (!args.filter && !args.handler) {\r\n        map.off(args.event)\r\n        this._eventCore.off(args.event)\r\n\r\n        _.remove(this._eventMap, evt => evt.event === args.event)\r\n\r\n        // Re-bind the basic click event\r\n        if (args.event === 'click') {\r\n            this._eventCore.on('click', fireSelectionChange.bind(this))\r\n        }\r\n    }\r\n}\r\n\r\nexport default {\r\n    _on,\r\n    _off\r\n}"],"file":"event.js"}